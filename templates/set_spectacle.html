<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html>

<head>
    <title>MODIFIER SPECTACLE</title>

    <script >

        var i = 0;

        function init(val){
          i = val;
        }

        function addOneDate(){

            var lastDate = document.getElementById("datetime"+i.toString());
            var lastNPlaces = document.getElementById("nPlaces"+i.toString());

            var div = document.createElement("div");
            var inputDate = document.createElement("INPUT");
            inputDate.setAttribute("type","datetime-local");
            i++;
            inputDate.setAttribute("name","datetime"+i.toString());
            inputDate.setAttribute("id","datetime"+i.toString());
            console.log(i);

            var br = document.createElement("br");

            div.appendChild(inputDate);

            var nPlace =document.createElement("input");
            nPlace.setAttribute("type","number");
            nPlace.setAttribute("id","nPlaces"+i.toString());
            nPlace.setAttribute("name","nPlaces"+i.toString());
            nPlace.setAttribute("min","0");
            nPlace.setAttribute("max","500");

            if(lastDate){
              inputDate.setAttribute("value",lastDate.value);
            }
            if(lastNPlaces){
              nPlace.setAttribute("value",lastNPlaces.value);
            }

            div.appendChild(nPlace);

            document.getElementById("date-div").appendChild(br);
            document.getElementById("date-div").appendChild(div);


        }
    </script>

</head>

<body>

  <p>Bienvenue sur la page de modification/création de spectacle : </p>
  <p>{{spectacle.nom}}
  <form action="" method="POST" enctype="multipart/form-data">
    <div>
      <label for="nom" >Nom du spectacle:<abbr title="required"></abbr></label><br>
      <input type="text" id="nom" name="nom" value='{{spectacle.nom}}'><br>
    </div>
    <div>
      <label for="resume">Résumé:</label><br>
      <input type="text" id="resume" name="resume"value='{{spectacle.resume}}' size=50><br>
    </div>
    <div>
      Photos:<br>
      <input type="file" name="photos" accept=".png, .jpg, .jpeg" multiple><br>
    </div>
    <div>
      Liens (Facebook, Instagram...):<br>
      <input type="url" name="liens" value='{{spectacle.liens}}'><br>
    </div>
      <br>
    <div>
      <label for="dates">Dates :  </label>
      <button type="button" id="addDate" onclick="addOneDate()" name="addDate">Add</button><br>
      <script>
        console.log("TEST");
        var datesLength = {{nDates}};
        init(datesLength);
        console.log("Number of dates already in:"+datesLength);
      </script>
      <div id="date-div">
        {%for date in dates:%}
          <div id="date{{loop.index}}">
            <input type="datetime-local" value="{{date.date}}" id="datetime{{loop.index}}" name="datetime{{loop.index}}" >
            <input type="number" value="{{date.placesRestantes}}" id="nPlaces{{loop.index}}" name="nPlaces{{loop.index}}" min="0" max="500">
          </div>
        {%endfor%}
      </div>
    </div>

    <div>
      <br><br>
      <button name="foo" id="submit" value="valider" type="submit"}>Valider</button>
    </div>
  </form>

</body>

</html>
